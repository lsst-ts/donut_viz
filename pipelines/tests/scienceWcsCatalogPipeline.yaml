# This yaml file is used to define the tasks and configuration of
# a Gen 3 pipeline used for testing in ts_wep.
description: wep basic processing test pipeline
# Here we specify the corresponding instrument for the data we
# will be using.
instrument: lsst.obs.lsst.LsstCam
# Then we can specify each task in our pipeline by a name
# and then specify the class name corresponding to that task
tasks:
  isr:
    class: lsst.ip.isr.IsrTaskLSST
    config:
      connections.outputExposure: post_isr_image
      python: |
        from lsst.cp.pipe import configureIsrTaskLSSTForCalibrations

        configureIsrTaskLSSTForCalibrations(config)
        config.doBootstrap = True
        config.doCrosstalk = False
  generateDonutCatalogWcsTask:
    class: lsst.ts.wep.task.generateDonutCatalogWcsTask.GenerateDonutCatalogWcsTask
    config:
      connections.exposure: post_isr_image
      donutSelector.unblendedSeparation: 1
  cutOutDonutsScienceSensorTask:
    class: lsst.ts.wep.task.CutOutDonutsScienceSensorTask
    config:
      connections.exposures: post_isr_image
  calcZernikesTask:
    class: lsst.ts.wep.task.calcZernikesTask.CalcZernikesTask
    config:
      python: |
        from lsst.ts.wep.task import EstimateZernikesTieTask
        config.estimateZernikes.retarget(EstimateZernikesTieTask)
      estimateZernikes.nollIndices: [4, 5, 6, 7, 8, 9, 10, 11, 14, 15, 20, 21, 22, 27, 28]
      estimateZernikes.saveHistory: False
      estimateZernikes.maskKwargs: {'doMaskBlends': False}
  aggregateZernikeTablesTask:
    class: lsst.donut.viz.AggregateZernikeTablesTask
  aggregateDonutTablesTask:
    class: lsst.donut.viz.AggregateDonutTablesTask
  aggregateDonutStampsTask:
    class: lsst.donut.viz.AggregateDonutStampsTask
  aggregateAOSVisitTableTask:
    class: lsst.donut.viz.AggregateAOSVisitTableTask
  plotAOSTask:
    class: lsst.donut.viz.PlotAOSTask
    config:
      doRubinTVUpload: False
  plotDonutTask:
    class: lsst.donut.viz.PlotDonutTask
    config:
      doRubinTVUpload: False
  plotPsfZernTask:
    class: lsst.donut.viz.PlotPsfZernTask
    config:
      doRubinTVUpload: False
