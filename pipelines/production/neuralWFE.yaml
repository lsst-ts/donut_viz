description: test pipeline for LSSTCam using neural network-based Zernike estimation
instrument: lsst.obs.lsst.LsstCam

tasks:
  calcZernikesNeuralTask:
    class: lsst.ts.wep.task.calcZernikesNeuralTask.CalcZernikesNeuralTask
    config:
      # Model paths set to null for testing (task will use random weights)
      wavenetPath: /sdf/home/p/peterma2/Rubin_AO_ML/training/finetune_logs/lightning_logs/version_0/checkpoints/best_finetuned_wavennet.ckpt
      alignetPath: /sdf/home/p/peterma2/Rubin_AO_ML/training/alignnet_logs/lightning_logs/version_0/checkpoints/best_alignnet_120.ckpt
      aggregatornetPath: /sdf/home/p/peterma2/Rubin_AO_ML/training/aggregator_logs/lightning_logs/version_0/checkpoints/best_aggregator.ckpt
      # Path to dataset parameters YAML file (will be created in test)
      datasetParamPath: /sdf/home/p/peterma2/TARTS/TARTS/dataset_params.yaml
      # Use CPU for testing
      device: "cpu"
      # Noll indices for Zernike coefficients (Z4-Z28, excluding piston/tip/tilt)
      nollIndices: [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 20, 21, 22, 27, 28]

# Define pipeline steps
subsets:
  step1-detectors:
    subset:
      - calcZernikesNeuralTask
    description: |
      This step processes the input images with ISR and directly estimates
      Zernike coefficients using the TARTS neural network system.
      No intermediate donut detection or cutting is required.

steps:
  - label: step1-detectors
    dimensions: [exposure, detector, instrument]

